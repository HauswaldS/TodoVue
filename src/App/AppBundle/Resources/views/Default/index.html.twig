<!DOCTYPE html>
<html>
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="{{ asset('assets/css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ asset('assets/css/main.css') }}" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
          integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/vue.resource/1.0.3/vue-resource.min.js"></script>
</head>
<body><
<div class="container-fluid" id="app">
    <div class="row">
        <div class="col-xs-8 col-xs-offset-2" id="wrapper">
            <div id="header" v-if="headerOn">
                <h1 class="display-3">${title}</h1>
                <p class="lead">This is a simple application using Symfony as Backend and Twig & Vue.js as Frontend.</p>
                <hr class="my-2">
                <p class="lead">
                    <a class="btn btn-primary btn-lg" href="#" role="button" @click="InitApp">Start to do stuff !</a>
                </p>
            </div>
            <div class="row" v-show="!headerOn">
                <h1 class="text-center">Write something and get to work !</h1>
                <hr>
                <div class="col-xs-8 col-xs-offset-2 form-group">
                    <em v-if="inputError" style="color:red;">Vous avez oubliez d'Ã©crire !</em>
                    <input type="text" class="form-control" v-model="todoInput"
                           placeholder="Qu'allez-vous faire aujourd'hui ?">
                    <button class="btn btn-success" @click="postTodo">Submit</button>
                </div>
                <div class="col-xs-12" id="lists">
                    <template v-if="todos.length > 0">
                        <div id="notDone" class="col-xs-6">
                            <h2>Not done yet <span class="fa fa-times" style="color:red;"></span></h2>
                            <template v-for="(todo, index) in todos">
                                <p v-if="todo.is_done === false">
                                    ${ todo.content }
                                    <input type="checkbox" @click="setIsDone(todo)" :checked="todo.is_done">
                                </p>
                            </template>
                        </div>
                        <div id="done" class="col-xs-6">
                            <h2>Done <span class="fa fa-check" style="color:green;"></span></h2>
                            <template v-for="(todo, index) in todos">
                                <p v-if="todo.is_done === true">
                                    ${ todo.content }
                                    <button class="btn btn-danger" @click="deleteTodo(index, todo.id)"><span
                                                class="fa fa-trash"></span></button>
                                </p>
                            </template>
                        </div>
                    </template>
                    <template v-else>
                        <h2>Vous n'avez pas encore de todo :)</h2>
                    </template>

                </div>
            </div>
        </div>
    </div>
</div>
<script
        src="https://code.jquery.com/jquery-3.1.1.slim.min.js"
        integrity="sha256-/SIrNqv8h6QGKDuNoLGA4iret+kyesCkHGzVUUV0shc="
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>
<
<script>
    new Vue({
        delimiters: ['${', '}'],
        el: "#app",
        data: {
            headerOn: true,
            inputError: false,
            seeDone: false,
            title: "TodoList",
            todoInput: "",
            todos: [],
        },
        methods: {
            InitApp: function () {
                this.$http.get('http://localhost/todovue/web/app_dev.php/api/todos').then(
                    (response) => {
                        console.log("Success :" + response);
                        this.headerOn = false;
                        this.todos = response.body;
                    },
                    (err) => {
                        console.log("Error :" + err);
                        this.todos = err.body;

                    })
            },
            postTodo: function () {
                if (this.todoInput) {
                    let content = this.todoInput;
                    this.todoInput = "";
                    this.inputError = false;

                    this.$http.post('http://localhost/todovue/web/app_dev.php/api/todos', {content: content}).then(
                        (response) => {
                            this.todos.push(response.body);
                        },
                        (err) => {
                            console.log(err);
                        }
                    )
                } else this.inputError = true;
            },
            setIsDone: function (todo) {
                let content = {
                    content: todo.content,
                    isDone: todo.is_done
                };
                this.$http.put('http://localhost/todovue/web/app_dev.php/api/todos/' + todo.id, content).then(
                    (response) => {
                        console.log(response);
                        todo.is_done = !todo.is_done;
                    },
                    (err) => {
                        console.log(err);
                    }
                )
            },
            deleteTodo: function (index, todoId) {
                this.$http.delete('http://localhost/todovue/web/app_dev.php/api/todos/' + todoId + "/delete").then(
                    (response) => {
                        this.todos.splice(index, 1);
                    },
                    (err) => {
                        console.log(err);
                    }
                )
            },

        }

    })
</script>
</body>
</html>